<div id="sbconsole" ng-controller="ConsoleController"  ng-app="sbconsole">
<style>
.table-striped tbody > tr:nth-child(odd).active > td {
	background-color:#08c;
	color:white;
}
.table-striped tbody > tr:nth-child(odd).active a {
color:white;
}
.table-striped tbody > tr:nth-child(even).active a {
color:white;
}
.table-striped tbody > tr:nth-child(even).active {
	color:white;
	background-color:#08c;
}
</style>
	<div class="alert" ng-class="m.error && 'alert-error' || 'alert-success'" ra-fade-out ng-repeat="m in messages" ng-bind-template="{{ m.text }}"></div>
	
	<div class="container-fluid">
  	<div class="row-fluid">
  
  		<div class="span3 well">
			<ul class="nav nav-list">
				<li class="nav-header">Jobs</li>
				<li ng-repeat="j in jobs" ng-class="selectedJob == j && 'active' || ''">
					<a href="#/jobs/{{j}}"  ng-bind-template="{{j}}"></a>
				</li>
  			</ul>

			<ul class="nav nav-list">
				<li class="nav-header">Historic Jobs</li>
				<li ng-repeat="hj in historicalJobs" ng-class="selectedHistoricJob == hj && 'active' || ''">
					<a href="#/history/jobs/{{hj}}" ng-bind-template="{{ hj }}"></a> 
				</li>
				
  			</ul>
		</div>

		<div class="span9" ng-show="selectedJob">
			<form class="form form-horizontal" ng-submit="submitJob()">
				<legend>Start a new Job</legend>
				<div class="control-group">
					<label class="control-label" for="jobParameters">Job</label>
					<div class="controls">
					<input type="text" readonly=true" name="jobName" ng-model="selectedJob" />
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="jobParameters">Parameters</label>
					<div class="controls">
					<textarea ng-model="jobParameters" name="jobParameters" rows="6" class="input-xlarge" required></textarea>
					<span ng-show="jobParameters.$error" class="help-inline">Enter job parameters.</span>
					</div>
				</div>
				<div class="form-actions">
					<button class="btn btn-primary" ng-disabled="jobSubmission.$invalid"><i class="icon-ok icon-white"></i> Submit Job</button>
				</div>
			</form>
		</div>
  		<div class="span9" ng-show="selectedHistoricJob">
  		  	<label for="ct">Page Size</label>
  			<select name="ct" ng-model="instancePage.count" ng-options="label for label in instancePage.counts"></select>
  		
  			<div class="pagination">
  <ul>
    <li ng-class="instancePage.start == 0 && 'disabled' || ''" ><a href="#" ng-click="instancePage.prev()">Prev</a></li>
    <li ng-class="instancePage.start == s && 'active' || ''" ng-repeat="s in instancePage.starts"><a href="#" ng-click="instancePage.go(s)">{{s+1}}</a></li>
    <li ng-class="instances.length < instancePage.count && 'disabled' || ''"><a href="#" ng-click="instancePage.next()">Next</a></li>
  </ul>
</div>

			  		
  		
  			<table class="table table-striped table-bordered">
  			<thead>
  				<tr>
  					<th>Id</th>
  					<th>Job</th>
  					<th>Parameters</th>
  					<th>Running</th>
  				</tr>
  				</thead>
  				<tbody>
  				<tr ng-repeat="i in instances" ng-class="i.id == selectedInstance.id && 'active' || ''">
  					<td><a href="#/history/jobs/{{i.jobName}}/{{i.id}}" >{{ i .id }}</a></td>
  					<td>{{ i.jobName }} </td>
  					<td>
  							<span ng-repeat="(k,v) in i.jobParameters">
							<span ng-show="$index > 0">, </span>
							{{k}}={{v}}
							</span>
  					</td>
  					<td>{{ i.running }}</td>
  				</tr>
  				</tbody>
  			</table>
		</div>
	</div>
	<div class="row-fluid">
	
		<div class="span12" ng-show="executions.length > 0">
  			<table class="table table-bordered table-striped">
  				
  				<!-- 
  				
{"id":3,
	"exceptions":[],
	"updated":"2013-05-23 20:51:15.0",
	"created":"2013-05-23 20:51:15.0",
	"steps":[{"summary":"StepExecution: id=3, version=43, name=job-1-step1, status=COMPLETED, exitStatus=COMPLETED, readCount=1001, filterCount=0, writeCount=1001 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=41, rollbackCount=0",
		"writeSkipCount":0,"processSkipCount":0,"rollbackCount":0,
		"status":"COMPLETED",
		"readCount":1001,"readSkipCount":0,
		"exitStatus":{"description":"","code":"COMPLETED"},
		"ended":"2013-05-23 20:51:15.0",
		"skipCount":0,
		"writeCount":1001,
		"id":3,"exceptions":[],
		"commitCount":41,
		"filterCount":0,
		"jobExecutionId":3,
		"updated":"2013-05-23 20:51:15.0","name":"job-1-step1","started":"2013-05-23 20:51:15.0"}],"ended":"2013-05-23 20:51:15.0","started":"2013-05-23 20:51:15.0"}  				
  				 -->
  				 <thead>
			<tr>
				<th colspan="2">Item Type</th>
				<th>Name</th>
				<th>Start Time</th>
				<th>End Time</th>
				<th>Read</th>
				<th>Write</th>
				<th>Skip</th>
				<th>Status </th>
				<th>Commands</th>
			</tr>
  				 </thead>
  				 
  				<tbody ng-repeat="e in executions">
  				<tr>
  					<td>Execution {{e.id}}</td>
  					<td></td>
  					<td>{{ selectedInstance.jobName}}</td>
  					<td>{{ e.started }}</td>
  					<td>{{ e.ended }}</td>
					<td colspan="3"></td>
  					<td>{{ e.status }}
  						<span ng-hide="e.status==e.exitStatus.code"><span ng-show="false"> / {{ e.exitStatus.code }}</span></span>
  					</td>
  					<td>
  						<span ng-repeat="c in e.commands">
  							<span ng-switch="c.op">
  								<button ng-switch-when="restart" class="btn btn-success btn-mini" ng-click="restart(e)">{{ c.name }} </button>
  								<button ng-switch-when="abandon" class="btn btn-danger btn-mini" ng-click="abandon(e)">{{ c.name }}</button>
  								<button ng-switch-when="pause" class="btn btn-warning btn-mini" ng-click="pause(e)">{{ c.name }} </button>
  							</span>
  						</span>
  						
  					</td>
  				</tr>
  				<tr ng-repeat="s in e.steps">
  					<td>&nbsp;</td>
  					<td>Step</td>
  					<td>{{ s.name }}</td>	
  					<td>{{ s.started }}</td>
  					<td>{{ s.ended }}</td>
  					<td>{{ s.readCount }}</td>
  					<td>{{ s.writeCount }}</td>
  					<td>{{ s.skipCount }}</td>
  					<td>{{ s.status }}
  						<span ng-hide="s.status==s.exitStatus.code"><span ng-show="false"> / {{ s.exitStatus.code }}</span></span>
  					</td>
  					<td></td>
  				</tr>
  				</tbody>
  			</table>
		</div>
		
	</div>
	</div>


</div>

<script type='text/javascript' src="${oscarContextPath}${oscarServletPath}/ui/angular/app.js"></script>